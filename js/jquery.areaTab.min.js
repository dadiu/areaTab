/**
 * @url
 * @data    2017.05.25
 * @author  wuhaijing
 * @mail    1004609378@qq.com
 * @version V1.2.1 - 扩展分页
 */
/********************* 传参说明 *********************/
/**
 * 以下均为必填参数
 * txt : string       	//提示文字
 * list : object    	//数据表，默认空
 *
 * 以下均为可选参数
 * maxNum : number      //每间隔最大，默认10
 * searchImg : string   //搜索按钮图片
 *
 * 以下为必填list结构说明
 * {areaKey1:{areaId:"",name:"",status:""},areaKey2:{areaId:"",name:"",status:""}};
 * name = '1-9 + " " + string' or '0 + " " + string' or 'string'
 * '1-9 + " " + string' = 正式大区 如 "1 火烧赤壁1区"
 * '0 + " " + string' = 删档测试区 如 "0 删档测试服"
 * 'string' = 技术封测服 如 "技术封测区"
 */
/******************** 开始 ********************/(function(b){b.fn.tabs=function(k){k=b.extend({txt:"\u63d0\u793a\u6587\u5b57",list:"",maxNum:10,searchImg:"http://whj.fayfox.com/img/ic_search.png"},k);var m={selA:b("\x3cdiv\x3e").addClass("u_sel_a"),selATxt:b("\x3clabel\x3e").addClass("u_sel_aTxt").html(k.txt),selB:b("\x3cdiv\x3e").addClass("u_sel_b"),selBTab:b("\x3cdiv\x3e").addClass("u_sel_bTab"),selBMenu:b("\x3cul\x3e").addClass("u_sel_bMenu"),selBSearch:b("\x3cdiv\x3e").addClass("u_sel_bSearch").append('\x3cinput type\x3d"text"/\x3e\x3cimg src\x3d"'+k.searchImg+'"/\x3e'),selBSearchTips:b("\x3cdiv\x3e").addClass("u_sel_bSearchTips"),selBList:b("\x3cul\x3e").addClass("u_sel_bList"),rememberInp:b('\x3cinput type\x3d"hidden" data-tip\x3d"#J_changeAreaTip" name\x3d"areaId"\x3e'),prevBtn:b("\x3ca\x3e").addClass("u_areaTabPrev").attr("href","javascript:;").html("\x26lt;"),nextBtn:b("\x3ca\x3e").addClass("u_areaTabNext").attr("href","javascript:;").html("\x26gt;")},f=this,g=0,h={init:function(b,a){this.V.getDoms(b,a);this.M.even(b,a)},V:{getDoms:function(b,a){a.selA.append(a.selATxt);a.selA.append('\x3ci class\x3d"ic_down"\x3e\x3c/i\x3e');a.selB.append(a.selBTab);a.selB.append(a.selBSearchTips);a.selB.append(a.selBList);a.selBList.append(this.domArea(b,a));a.selBMenu.append(h.M.tabCount(h.M.allLen,b));a.selBTab.append(a.prevBtn);a.selBTab.append(a.selBMenu);a.selBTab.append(a.nextBtn);a.selBTab.append(a.selBSearch);f.css("position","relative");f.append(a.selA);f.append(a.selB);f.append(a.rememberInp);f.addClass("u_sel u_areaTab")},domArea:function(b,a){for(var c="",d=h.M.resetList(b.list),e=d[0].length,p=d[1].length,l=0,f=0;l<e;l++)d[0][l]&&(c+='\x3cli data-val\x3d"'+d[0][l].val+'" data-other\x3d"0"\x3e'+d[0][l].name+"\x3c/li\x3e",h.M.allLen++);for(;f<p;f++)d[1][f]&&(c+='\x3cli data-val\x3d"'+d[1][f].val+'" data-other\x3d"1"\x3e'+d[1][f].name+"\x3c/li\x3e",h.M.otherLen++);return c}},M:{allLen:0,otherLen:0,MAX_PAGE:0,even:function(e,a){var c=this,d="";a.selA.click(function(){b(this).attr("data-boo")||(a.selBList.find("li").hide(),a.selBTab.find("li:eq(0)").addClass("crt").css("border-left","0"),a.selBList.find("li:lt("+e.maxNum+")").show(),b(this).attr("data-boo",1));f.css("z-index","99");a.selB.slideDown(100);return!1});a.selBList.find("li").click(function(){var c=b(this).text(),d=b(this).attr("data-val");a.selATxt.text(c);a.rememberInp.val(d).attr("data-Name",c)});c.MAX_PAGE=a.selBMenu.find("li").length;if(6<=c.MAX_PAGE){var n=Math.floor(c.MAX_PAGE/5);a.selBSearch.addClass("u_sel_bSearchHide");a.selBSearch.click(function(){a.selBSearch.removeClass("u_sel_bSearchHide");c.setCursorPosition(a.selBSearch.find("input").get(0),a.selBSearch.find("input").val().length);a.selBTab.addClass("u_sel_bTabHide");a.nextBtn.addClass("u_areaTabNextMove")});a.selBMenu.find("li").mouseenter(function(){a.selBSearch.addClass("u_sel_bSearchHide");a.selBTab.removeClass("u_sel_bTabHide");a.nextBtn.removeClass("u_areaTabNextMove")});a.selBTab.addClass("u_sel_bTabMore");a.nextBtn.click(function(){if(g<n)return g++,console.log(g),a.selBMenu.animate({"margin-left":200*-g+15}),!1});a.prevBtn.click(function(){if(0<g)return g--,a.selBMenu.animate({"margin-left":200*-g+15}),!1})}a.selBSearch.click(function(){d=a.selBSearch.find("input").val();c.searchFun(a,d,"\u8bf7\u8f93\u5165\u4f60\u8981\u641c\u7d22\u7684\u5927\u533a");return!1});a.selBSearch.find("input").keyup(function(){d=b(this).val();c.searchFun(a,d,"\u4f60\u641c\u7d22\u7684\u5927\u533a\u4e0d\u5b58\u5728");return!1});a.selBMenu.find("li").mouseenter(function(){var c=b(this).text(),d;a.selBSearchTips.hide();b(this).addClass("crt").siblings().removeClass("crt");a.selBSearch.find("input").val("");"\u5176\u4ed6"==c?(a.selBList.find('li[data-other\x3d"0"]').hide(),a.selBList.find('li[data-other\x3d"1"]').show()):(c=b(this).text().split("-")[0]-2,d=b(this).text().split("-")[1],a.selBList.find("li").hide(),0>c?a.selBList.find('li[data-other\x3d"0"]:lt('+d+")").show():a.selBList.find('li[data-other\x3d"0"]:lt('+d+"):gt("+c+")").show())});a.selBTab.find("li").click(function(){return!1});b("body").click(function(){f.css("z-index","1");a.selB.hide()})},searchFun:function(e,a,c){var d=0;e.selBTab.find("li").removeClass("crt");e.selBList.find("li").each(function(){-1<b(this).text().indexOf(a)?(b(this).show(),d++):b(this).hide()});1>d?e.selBSearchTips.show().html(c):e.selBSearchTips.hide()},resetList:function(e){var a={0:[],1:[]},c=0;b.each(e,function(b,e){e.val=b;c=e.name.split(" ")[0];/^[1-9]\d*$/.test(c)?a[0][c]=this:a[1].push(this)});return a},tabCount:function(b,a){for(var c=Math.ceil(b/a.maxNum),d=0,e="";d<c;d++)e+="\x3cli\x3e"+(15*d+1)+"-"+15*(d+1)+"\x3c/li\x3e";0<this.otherLen&&(e+="\x3cli\x3e\u5176\u4ed6\x3c/li\x3e");return e},setCursorPosition:function(b,a){if(b.setSelectionRange)b.focus(),b.setSelectionRange(a,a);else if(b.createTextRange){var c=b.createTextRange();c.collapse(!0);c.moveEnd("character",a);c.moveStart("character",a);c.select()}}}};h.init(k,m)}})(jQuery);